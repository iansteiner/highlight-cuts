# Testing Infrastructure

This document outlines the strategy for testing non-Python components of the `highlight-cuts` application, specifically the Web Interface (HTML/Templates) and the Docker container.

## Philosophy
To keep the development workflow simple and unified, we leverage **`pytest`** as the primary test runner for *all* tests, including those that target non-Python artifacts. This avoids the need for users to learn additional tools like `npm`, `jest`, or complex shell scripts.

## Testing Strategies

### 1. Web Interface (HTML/Jinja2)
We test the web interface by inspecting the HTML generated by the FastAPI application.

*   **Tool**: `pytest` + `fastapi.testclient.TestClient` + `BeautifulSoup4`
*   **Location**: `tests/test_web.py`
*   **Method**:
    1.  Use `TestClient` to make requests to the application endpoints (e.g., `GET /`).
    2.  Parse the response `content` using `BeautifulSoup`.
    3.  Assert that specific HTML elements exist, have correct attributes, or contain expected text.
    *   *Example*: Check that the `<form>` has `method="post"` and the correct `action`.

### 2. Docker Container
We test the Docker container to ensure the application starts up correctly and the environment is configured properly (e.g., `ffmpeg` is installed).

*   **Tool**: `pytest` + `subprocess` (or `python-on-whales` if complexity grows)
*   **Location**: `tests/test_docker.py`
*   **Method**:
    1.  **Build**: A test fixture builds the Docker image (tagged `highlight-cuts:test`).
    2.  **Run**: The fixture starts the container, mapping a random port.
    3.  **Health Check**: The test waits for the container to become healthy (responding to HTTP requests).
    4.  **Verify**:
        *   Run commands inside the container (e.g., `ffmpeg -version`) to verify dependencies.
        *   Make HTTP requests to the exposed port to verify the app is serving traffic.
    5.  **Cleanup**: The fixture stops and removes the container after tests finish.

## Running Tests
All tests can be run with the standard command:

```bash
uv run pytest
```

To run only the web or docker tests:

```bash
uv run pytest tests/test_web.py
uv run pytest tests/test_docker.py
```

## Prerequisites
*   **Docker**: Must be running for `test_docker.py` to pass.
*   **Dependencies**: `beautifulsoup4` and `httpx` (required by TestClient) must be installed in the dev environment.
